<!-- Treatment page. After a patient reserves a provider, a provider will know whether to give
	 a phone consultation or a house call and they will give an estimate of when the patient
	 will receive their treatment. -->

<template name="treatmentPage">

	<!-- CSS -->
	<style>

		/* Shows pointer finger when hovering over dashboard steps menu */
		.ui.pointing.menu {
			cursor: pointer;
		}
		
		/* Makes textarea fluid (Full wdth of container) */
		textarea {
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;

			width: 100%;
	  	}
	</style>

	<div class="ui raised very padded text container segment">
		<!-- dashboard -->
		<div class="ui centered card">
		  <div id="imageProvider" class="image">
		  	<!-- image of provider -->
		  </div>
		  <div class="content">
		  	<h3 id="providerName" class="ui header"><!-- Provider name --></h3>
		  </div>
		</div>
	  
	  	<center>
		    <h3 id="reserveProviderText" class="ui header"></h3>
		    
		    <h3 id="timeApproxText" class="ui header"></h3>

		    <br>
		  
			<div class="cancelBtn ui negative button">
				Cancel Reservation
			</div>
		</center>
	</div>

	<div class="ui small modal" id="reasonModal">
	  <i class="close icon"></i>
	  <div class="header">
	    <center>Cancel Reservation</center>
	  </div>

	  <div class="content">
	  	<div class="ui warning message"><i class="warning sign icon"></i> Cancellation will result in a cancellation fee.</div>
	  	<form class="ui form" id="reasonForm">
	  		<div class="required field">
	  			<label>Please let us know why you are canceling in the box below:</label>
		  		<textarea name="reason" id="reason" rows="3"></textarea>
		  	</div>
	  	</form>
	  </div>

	  <div class="actions" id="cancelReqButtons">
	  	<div class="two ui buttons">
		    <button class="ui red button" id="confirmCancelBtn">
		      Confirm Cancellation
		    </button>
		    <button class="ui cancel button" id="nevermindBtn">
		      Nevermind
		    </button>
		</div>
	  </div>
	</div>

	<div class="ui cancelled-redirect small modal">
		<i class="close icon"></i>
    	<div class="header">
    		<center>You have canceled your reservation.</center>
  		</div>

  		<div class="content">
  			<center><h4>We will now redirect you to your dashboard.</h4></center>
  		</div>

  		<div class="actions" id="returnDashboard">
			<button class="ui fluid primary button">
		    	Return to Dashboard
		    </button>
		</div>

	</div>

	<!-- JavaScript -->
	<script type="text/javascript">
		var providerName = "Ernest";
		var patientName = "Pauline";
		var timeApproxHr = "3";
		var timeApproxMin = "00";
		var timeApproxPeriod = "PM";

		document.getElementById("providerName").innerHTML = providerName;

		var reservedProviderText = "You have reserved " + providerName + ".";
		document.getElementById("reserveProviderText").innerHTML = reservedProviderText;

		var imageSrc = "/images/drbrown.jpg";
		var imageHTML = "<img src=\"" + imageSrc + "\">";
		document.getElementById("imageProvider").innerHTML = imageHTML;

		var timeApproxText = "You will receive care at approximately " + timeApproxHr + ":" + timeApproxMin + timeApproxPeriod + "<br>Please rest up now, " + patientName;
		document.getElementById("timeApproxText").innerHTML = timeApproxText;


		$(document).ready(function(){
			// Click cancel button
			$(".cancelBtn").click(function(){
				$('#reasonModal').modal({
					autofocus: false,	// Prevents dropdown from dropping automatically
				}).modal('show');
			});

			// Click to return to dashboard button
			$("#returnDashboard").click(function(){
				$('#returnDashboard').modal('hide');
				FlowRouter.go('/dashboard');	// Redirects to dashboard
			});

			// Validate cancel form
			$("#reasonForm").form({
				inline: true,
				on: "blur",
				transition: "slide down",

				// Submit cancel form - add cancel reason to database
				onSuccess: function(event, fields) {
					event.preventDefault();

					// Add cancel reason to database

					// Click to cancel request button
					$("#confirmCancelBtn").click(function(){
						$('#reasonModal').modal('hide');
						$('.cancelled-redirect').modal('show');
					});
				},
				fields: {
					reason: {
						identifier: "reason",
						rules: [
							{
								type: "empty",
								prompt: "Please write a reason for canceling."
							},{
								type: "maxLength[350]",
								prompt: "Please enter at most 350 characters."
							}
						]
					}
				}
			});

		});

		// Multi-select dropdown functionality
		$('#multi-select')
		  .dropdown()
		;
	</script>
</template>