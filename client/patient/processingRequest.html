<!-- Processing request -->

<template name="processingRequestPage">

	<!-- CSS -->
	<style>
		/* Shows pointer finger when hovered over dashboard menu */
		.ui.pointing.menu {
			cursor: pointer;
		}
		
		/* Makes textarea fluid */
		textarea {
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;

			width: 100%;
	  	}
	</style>

	<!-- Informative box about how long call wait will be -->
	
	<center>
		<div class="ui raised very padded text container segment">
			<h2 class="ui header">We are processing your request and will take care of you soon, {{getFirstName}}<br><br>
			Thank you for choosing Doctors To You!</h2>

			<br>

			<button class="cancelBtn negative ui button">Cancel Request</button>

			<br>

			<h3 class="ui header">Doctors To You Blog</h3>

		   	<hr>

		   	<!-- blog posts -->
		</div>
	</center>
	

	<!-- Cancel modal -->
	<div class="ui small modal" id="reasonModal">
	
	  <i class="close icon"></i>
	  <div class="header">
	  	<center>Cancel Request</center>
	  </div>

	  <br>

	  <form class="ui form" id="reasonForm">
		  
	  		<div class="required field">
	  			<label>Please let us know why you are canceling in the box below:</label>
		  		<textarea name="reason" id="reason" rows="3"></textarea>
		  	</div>
		 
		  <br>

		  <div class="actions" id="cancelReqButtons">
		  	<div class="two ui buttons">
			    <button  class="ui red button" type="submit" id="confirmCancelBtn">
			      Confirm Cancellation
			    </button>
			    <button class="ui cancel button" type="button" id="nevermindBtn">
			      Nevermind
			    </button>
			</div>
		  </div>
	  </form>
	</div>
	


	<!-- After cancelled request, will open this confirmation modal -->
	<div class="ui cancelled-redirect small modal">
		<i class="close icon"></i>
    	<div class="header">
    		<center>You have cancelled your request.</center>
  		</div>

  		<div class="content">
  			<center><h4>We will now redirect you to your dashboard.</h4></center>
  		</div>

  		<!-- Redirect button to dashboard -->
  		<div class="actions" id="returnDashboard">
			<button class="ui fluid primary button">
		    	Return to Dashboard
		    </button>
		</div>

	</div>

	<!-- {{/each}} -->

	<!-- JavaScript -->
	<script type="text/javascript">

		var firstname = Session.get('firstname');

		$(document).ready(function(){

			// Click to open cancel request button
			$(".cancelBtn").click(function(){
				$('#reasonModal').modal('show');	
			});

			// Validate cancel form
			$("#reasonForm").form({
				inline: true,
				on: "submit",
				transition: "slide down",

				// Submit cancel form - add cancel reason to database
				onSuccess: function(event, fields) {
					event.preventDefault();
					// Add cancel reason to database

					// Click to cancel request button
					$('#reasonModal').modal('hide');
					$('.cancelled-redirect').modal('show');

					// Click to return to dashboard button. Reset request
					$("#returnDashboard").click(function(){
						$('#returnDashboard').modal('hide');
						Meteor.call('resetStatus', Meteor.userId());
					});

					
				},
				fields: {
					reason: {
						identifier: "reason",
						rules: [
							{
								type: "empty",
								prompt: "Please write a reason for canceling."
							},{
								type: "maxLength[350]",
								prompt: "Please enter at most 350 characters."
							},{
								type: "minLength[10]",
								prompt: "Please enter at least 10 characters."
							}
						]
					}
				}
			});
		});

		Template.processingRequestPage.helpers({

			// getFirstName: function(){
			// 	return Session.get('firstname');
			// }

			getFirstName: function(){
				var emailAddress = Meteor.users.findOne({_id: Meteor.userId()}).emails[0].address;
				return Profiles.findOne({email: emailAddress}).firstname;
			}

		});

	</script>

</template>
